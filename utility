#!/usr/bin/env python3
"""Grid overlay utility for images."""

import sys
import os
from pathlib import Path
from screenclicker.preprocessor import add_grid


def main():
    if len(sys.argv) != 2:
        print("Usage: ./utility image.jpg")
        sys.exit(1)
    
    input_path = Path(sys.argv[1])
    
    if not input_path.exists():
        print(f"Error: File '{input_path}' not found")
        sys.exit(1)
    
    # Read input image
    with open(input_path, 'rb') as f:
        image_bytes = f.read()
    
    # Add grid overlay
    try:
        grid_image_bytes = add_grid(image_bytes)
    except Exception as e:
        print(f"Error processing image: {e}")
        sys.exit(1)
    
    # Generate output filename
    output_path = input_path.parent / f"{input_path.stem}_grid{input_path.suffix}"
    
    # Save result
    with open(output_path, 'wb') as f:
        f.write(grid_image_bytes)
    
    print(f"Grid overlay saved to: {output_path}")


if __name__ == "__main__":
    main()